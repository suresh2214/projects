/* ---------------------------------------------------------
   ART GALLERY DATABASE SYSTEM  
   Technologies: PostgreSQL, pgAdmin
   Author: (suresh)
   Description:
      Relational database designed for managing artists,
      artworks, exhibitions, acquisitions, sales, and loans.
      Schema follows proper normalization up to 3NF.
   --------------------------------------------------------- */

-- Drop tables if they already exist (for development use only)
DROP TABLE IF EXISTS exhibition_artwork CASCADE;
DROP TABLE IF EXISTS exhibition CASCADE;
DROP TABLE IF EXISTS acquisition CASCADE;
DROP TABLE IF EXISTS sale CASCADE;
DROP TABLE IF EXISTS loan CASCADE;
DROP TABLE IF EXISTS artwork CASCADE;
DROP TABLE IF EXISTS artist CASCADE;
DROP TABLE IF EXISTS category CASCADE;
DROP TABLE IF EXISTS medium CASCADE;
DROP TABLE IF EXISTS gallery_location CASCADE;
DROP TABLE IF EXISTS supplier CASCADE;
DROP TABLE IF EXISTS customer CASCADE;
DROP TABLE IF EXISTS employee CASCADE;

------------------------------------------------------------
-- Master / Reference Tables
------------------------------------------------------------

-- Artist information
CREATE TABLE artist (
    artist_id      SERIAL PRIMARY KEY,
    name           VARCHAR(120) NOT NULL,
    birth_year     INT,
    death_year     INT,
    nationality    VARCHAR(120),
    biography      TEXT
);

-- Artwork category (painting, sculpture)
CREATE TABLE category (
    category_id    SERIAL PRIMARY KEY,
    category_name  VARCHAR(100) UNIQUE NOT NULL
);

-- Art medium (oil, acrylic, bronze)
CREATE TABLE medium (
    medium_id      SERIAL PRIMARY KEY,
    medium_name    VARCHAR(100) UNIQUE NOT NULL
);

-- Physical gallery locations
CREATE TABLE gallery_location (
    location_id    SERIAL PRIMARY KEY,
    location_name  VARCHAR(120) NOT NULL,
    address        TEXT,
    phone          VARCHAR(20)
);

-- Supplier table (from whom artwork was acquired)
CREATE TABLE supplier (
    supplier_id    SERIAL PRIMARY KEY,
    supplier_name  VARCHAR(120) NOT NULL,
    contact_info   TEXT
);

-- Customer information
CREATE TABLE customer (
    customer_id    SERIAL PRIMARY KEY,
    full_name      VARCHAR(120) NOT NULL,
    email          VARCHAR(120),
    phone          VARCHAR(20)
);

-- Employees handling sales / management
CREATE TABLE employee (
    employee_id    SERIAL PRIMARY KEY,
    full_name      VARCHAR(120) NOT NULL,
    role           VARCHAR(100),
    email          VARCHAR(120)
);

------------------------------------------------------------
-- Core Transaction Tables
------------------------------------------------------------

-- Main artwork table
CREATE TABLE artwork (
    artwork_id       SERIAL PRIMARY KEY,
    title            VARCHAR(200) NOT NULL,
    year_created     INT,
    artist_id        INT REFERENCES artist(artist_id) ON DELETE CASCADE,
    category_id      INT REFERENCES category(category_id),
    medium_id        INT REFERENCES medium(medium_id),
    width_cm         NUMERIC(10,2),
    height_cm        NUMERIC(10,2),
    depth_cm         NUMERIC(10,2),
    estimated_value  NUMERIC(14,2),
    status           VARCHAR(30) DEFAULT 'in_collection',
    description      TEXT,
    created_on       TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Record of acquisitions
CREATE TABLE acquisition (
    acquisition_id   SERIAL PRIMARY KEY,
    artwork_id       INT NOT NULL REFERENCES artwork(artwork_id),
    supplier_id      INT REFERENCES supplier(supplier_id),
    acquisition_date DATE DEFAULT CURRENT_DATE,
    price_paid       NUMERIC(14,2),
    notes            TEXT
);

-- Exhibitions held by the gallery
CREATE TABLE exhibition (
    exhibition_id    SERIAL PRIMARY KEY,
    title            VARCHAR(200) NOT NULL,
    start_date       DATE NOT NULL,
    end_date         DATE,
    location_id      INT REFERENCES gallery_location(location_id),
    description      TEXT
);

-- A junction table linking artworks to exhibitions
CREATE TABLE exhibition_artwork (
    id               SERIAL PRIMARY KEY,
    exhibition_id    INT NOT NULL REFERENCES exhibition(exhibition_id) ON DELETE CASCADE,
    artwork_id       INT NOT NULL REFERENCES artwork(artwork_id) ON DELETE CASCADE,
    display_position VARCHAR(100),
    UNIQUE (exhibition_id, artwork_id)
);

-- Artwork sales
CREATE TABLE sale (
    sale_id          SERIAL PRIMARY KEY,
    artwork_id       INT NOT NULL REFERENCES artwork(artwork_id),
    customer_id      INT REFERENCES customer(customer_id),
    employee_id      INT REFERENCES employee(employee_id),
    sale_date        TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    sale_price       NUMERIC(14,2) NOT NULL,
    payment_method   VARCHAR(50)
);

-- Artwork loan records (to/from museums or collectors)
CREATE TABLE loan (
    loan_id          SERIAL PRIMARY KEY,
    artwork_id       INT NOT NULL REFERENCES artwork(artwork_id),
    borrower         VARCHAR(200) NOT NULL,
    start_date       DATE NOT NULL,
    end_date         DATE,
    returned_date    DATE,
    loan_type        VARCHAR(20) DEFAULT 'outgoing',
    notes            TEXT
);

------------------------------------------------------------
-- Sample Data (for testing and demonstration)
------------------------------------------------------------

-- Artists
INSERT INTO artist (name, birth_year, nationality)
VALUES
('Vincent van Gogh', 1853, 'Dutch'),
('Frida Kahlo', 1907, 'Mexican'),
('Ravi Kumar', 1988, 'Indian');

-- Categories
INSERT INTO category (category_name)
VALUES ('Painting'), ('Sculpture'), ('Photography');

-- Mediums
INSERT INTO medium (medium_name)
VALUES ('Oil'), ('Acrylic'), ('Bronze'), ('Digital');

-- Gallery locations
INSERT INTO gallery_location (location_name, address)
VALUES
('Main Gallery', '12 Art Street, Delhi'),
('Annex Hall', '45 Culture Avenue, Mumbai');

-- Suppliers
INSERT INTO supplier (supplier_name, contact_info)
VALUES ('Private Collector', 'collector@example.com');

-- Artworks
INSERT INTO artwork (title, year_created, artist_id, category_id, medium_id, width_cm, height_cm, estimated_value)
VALUES
('Starry Night (Replica)', 1889, 1, 1, 1, 50, 40, 1000000),
('Self Portrait Study', 1932, 2, 1, 2, 40, 50, 250000),
('Urban Dreams', 2019, 3, 1, 4, 60, 80, 20000);

-- Acquisition records
INSERT INTO acquisition (artwork_id, supplier_id, price_paid)
VALUES (1, 1, 800000), (2, NULL, 200000);

-- Exhibition example
INSERT INTO exhibition (title, start_date, end_date, location_id)
VALUES ('Modern Perspectives', '2024-10-01', '2024-12-15', 1);

-- Map artworks to the exhibition
INSERT INTO exhibition_artwork (exhibition_id, artwork_id, display_position)
VALUES (1, 3, 'North Wall');

-- Customer + Employee
INSERT INTO customer (full_name, email)
VALUES ('Asha Patel', 'asha@example.com');

INSERT INTO employee (full_name, role, email)
VALUES ('Rohit Singh', 'Sales Manager', 'rohit@example.com');

-- Sale record
INSERT INTO sale (artwork_id, customer_id, employee_id, sale_price, payment_method)
VALUES (3, 1, 1, 22000, 'Credit Card');

-- Loan example
INSERT INTO loan (artwork_id, borrower, start_date, end_date, loan_type)
VALUES (2, 'City Museum', '2024-11-01', '2025-02-01', 'outgoing');
